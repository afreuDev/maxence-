---
import Layout from '~/layouts/LandingLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Values from '~/components/home/Values.astro';
import BioMinimal from '~/components/home/BioMinimal.astro';
import Calendar from '~/components/widgets/Calendar.astro';
import Results from '~/components/widgets/Results.astro';
import Partners from '~/components/widgets/Partners.astro';
import ContactSection from '~/components/widgets/ContactSection.astro';
import type { MetaData } from '~/types';
import heroImageFile from '~/assets/images/hero-maxence.jpg';

import { getAthlete, getResults, getUpcomingRace, getPartners } from '~/lib/cms/fetchers';
import { CMS_ENABLED } from '~/lib/cms/client';

const athlete = await getAthlete();
const results = await getResults({ limit: 5 });
const nextRace = await getUpcomingRace();
const partners = await getPartners();

const heroImage = {
  src: CMS_ENABLED && athlete.frontmatter.cover ? athlete.frontmatter.cover : heroImageFile,
  alt: 'Maxence Mey triathlète',
};

const metadata: MetaData = {
  title: 'Maxence Mey - Triathlète Professionnel',
  description: 'Résultats, calendrier, partenaires, et contact de Maxence Mey, triathlète professionnel français.',
  nextRace: nextRace,
  athlete: athlete.frontmatter,
  openGraph: {
    images: [
      {
        url: CMS_ENABLED && athlete.frontmatter.cover ? athlete.frontmatter.cover : '~/assets/images/hero-maxence.jpg',
      },
    ],
  },
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget -->
  <Hero image={heroImage} />

  <!-- Partners Widget -->
  <Partners partners={partners} />

  <!-- Values Widget -->
  <Values values={athlete.frontmatter.values} />

  <!-- BIO MINIMALISTE (remplace l’ancienne section bio) -->
  <BioMinimal data={athlete.frontmatter} />

  <!-- Calendar Widget -->
  <Calendar race={nextRace} />

  <!-- Results Widget -->
  <Results results={results} />

  <!-- Contact Widget -->
  <ContactSection id="contact"/>
</Layout>
