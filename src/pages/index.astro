---
import Layout from '~/layouts/LandingLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Stats from '~/components/widgets/Stats.astro';
import BioMinimal from '~/components/home/BioMinimal.astro';
import * as athlete from '~/content/athlete/maxence-mey.md';
import Calendar from '~/components/widgets/Calendar.astro';
import Results from '~/components/widgets/Results.astro';
import Partners from '~/components/widgets/Partners.astro';
import ContactSection from '~/components/widgets/ContactSection.astro';
import calendarData from '~/content/calendar/2025.yaml';
import type { Race, MetaData } from '~/types';
import heroImageFile from '~/assets/images/hero-maxence.jpg';

// Find next race for SEO metadata
const { upcoming } = calendarData;
const today = new Date();
today.setHours(0, 0, 0, 0);
const futureRaces = upcoming
  .map((race: Omit<Race, 'date'> & { date: string }) => ({ ...race, date: new Date(race.date) }))
  .filter((race: Race) => race.date.getTime() >= today.getTime())
  .sort((a: Race, b: Race) => a.date.getTime() - b.date.getTime());
const nextRace: Race | undefined = futureRaces.length > 0 ? futureRaces[0] : undefined;

const heroImage = {
  src: heroImageFile.src,
  alt: 'Maxence Mey triathlète',
};

const metadata: MetaData = {
  title: 'Maxence Mey - Triathlète Professionnel',
  description: 'Résultats, calendrier, partenaires, et contact de Maxence Mey, triathlète professionnel français.',
  nextRace: nextRace,
  openGraph: {
    images: [
      {
        url: heroImage.src,
      },
    ],
  },
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget -->
  <Hero
    actions={[
      {
        variant: 'primary',
        text: 'Suivre sur Instagram',
        href: 'https://instagram.com/maxencemeytri',
        target: '_blank',
        icon: 'tabler:brand-instagram',
      },
      { text: 'Contact', href: '#contact' },
    ]}
    image={heroImage}
  >
    <Fragment slot="title"> Maxence Mey </Fragment>

    <Fragment slot="subtitle">
      <span class="block sm:inline">Triathlète professionnel</span>
      <span class="hidden sm:inline"> · </span>
      <span class="block sm:inline">Middle Distance / 70.3</span>
    </Fragment>
  </Hero>

  <!-- Stats Widget -->
  <Stats
    stats={[
      { title: 'Victoire', amount: 'IM 70.3 Tanger 2023' },
      { title: 'Podium', amount: 'Challenge Turku 2025' },
      { title: 'Top 10', amount: 'Challenge Gdańsk 2025' },
      { title: 'Club', amount: 'KEFORMA / Munegu' },
    ]}
  />

  <!-- BIO MINIMALISTE (remplace l’ancienne section bio) -->
  <BioMinimal data={athlete.frontmatter} />

  <!-- Calendar Widget -->
  <section id="calendrier">
    <Calendar />
  </section>

  <!-- Results Widget -->
  <section id="resultats">
    <Results />
  </section>

  <!-- Partners Widget -->
  <section id="partenaires">
    <Partners />
  </section>

  <!-- Contact Widget -->
  <section id="contact">
    <ContactSection />
  </section>
</Layout>
