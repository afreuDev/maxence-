---
import Layout from '~/layouts/LandingLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Stats from '~/components/widgets/Stats.astro';
import BioMinimal from '~/components/home/BioMinimal.astro';
import Calendar from '~/components/widgets/Calendar.astro';
import Results from '~/components/widgets/Results.astro';
import Partners from '~/components/widgets/Partners.astro';
import ContactSection from '~/components/widgets/ContactSection.astro';
import type { MetaData } from '~/types';
import heroImageFile from '~/assets/images/hero-maxence.jpg';

import { getAthlete, getResults, getUpcomingRace, getPartners } from '~/lib/cms/fetchers';
import { CMS_ENABLED } from '~/lib/cms/client';

const athlete = await getAthlete();
const results = await getResults({ limit: 5 });
const nextRace = await getUpcomingRace();
const partners = await getPartners();

const heroImage = {
  src: CMS_ENABLED && athlete.frontmatter.cover ? athlete.frontmatter.cover : heroImageFile,
  alt: 'Maxence Mey triathlète',
};

const metadata: MetaData = {
  title: 'Maxence Mey - Triathlète Professionnel',
  description: 'Résultats, calendrier, partenaires, et contact de Maxence Mey, triathlète professionnel français.',
  nextRace: nextRace,
  openGraph: {
    images: [
      {
        url: CMS_ENABLED && athlete.frontmatter.cover ? athlete.frontmatter.cover : '~/assets/images/hero-maxence.jpg',
      },
    ],
  },
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget -->
  <Hero
    actions={[
      {
        variant: 'primary',
        text: 'Suivre sur Instagram',
        href: athlete.frontmatter.socials.instagram,
        target: '_blank',
        icon: 'tabler:brand-instagram',
      },
      { text: 'Contact', href: '#contact' },
    ]}
    image={heroImage}
  >
    <Fragment slot="title"> {athlete.frontmatter.title} </Fragment>

    <Fragment slot="subtitle">
      <span class="block sm:inline">{athlete.frontmatter.role}</span>
    </Fragment>
  </Hero>

  <!-- Stats Widget -->
  <Stats
    stats={[
      { title: 'Victoire', amount: 'IM 70.3 Tanger' },
      { title: 'Podium', amount: 'Challenge Turku' },
      { title: 'Top 10', amount: 'Challenge Gdańsk' },
    ]}
  />

  <!-- BIO MINIMALISTE (remplace l’ancienne section bio) -->
  <BioMinimal data={athlete.frontmatter} />

  <!-- Calendar Widget -->
  <section id="calendrier" class="py-12 md:py-16 lg:py-24">
    <Calendar race={nextRace} />
  </section>

  <!-- Results Widget -->
  <section id="resultats">
    <Results results={results} />
  </section>

  <!-- Partners Widget -->
  <section id="partenaires">
    <Partners partners={partners} />
  </section>

  <!-- Contact Widget -->
  <section id="contact">
    <ContactSection />
  </section>
</Layout>
