---
import { getCollection } from 'astro:content';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';

const results = (await getCollection('results')).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const getPodiumClass = (rank: number) => {
  if (rank === 1) return 'bg-yellow-200 text-yellow-900 ring-1 ring-inset ring-yellow-600/30';
  if (rank === 2) return 'bg-slate-200 text-slate-900 ring-1 ring-inset ring-slate-600/30';
  if (rank === 3) return 'bg-amber-200 text-amber-900 ring-1 ring-inset ring-amber-700/30';
  return 'bg-gray-100 text-gray-800 ring-1 ring-inset ring-gray-500/10';
};
---

<WidgetWrapper>
  <Headline>
    <Fragment slot="title">Résultats</Fragment>
    <Fragment slot="subtitle">
      Retrouvez ici le palmarès de Maxence Mey sur les courses nationales et internationales.
    </Fragment>
  </Headline>
  <div class="relative not-prose overflow-x-auto">
    <table class="w-full text-left table-fixed">
      <thead class="text-sm text-gray-500 dark:text-gray-400 uppercase">
        <tr>
          <th class="px-4 py-3 text-left w-[120px]">Date</th>
          <th class="px-4 py-3 text-left w-auto min-w-[200px]">Course</th>
          <th class="px-4 py-3 text-left w-[90px]">Dist.</th>
          <th class="px-4 py-3 text-center w-[100px]">Classt.</th>
          <th class="px-4 py-3 text-left w-[110px]">Temps</th>
          <th class="px-4 py-3 text-center w-[100px]">Source</th>
        </tr>
      </thead>
      <tbody>
        {
          results.map((result) => (
            <tr class="border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition">
              <td class="px-4 py-3 font-medium">
                {new Date(result.data.date).toLocaleDateString('fr-FR', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric',
                })}
              </td>
              <td class="px-4 py-3 font-bold">{result.data.title}</td>
              <td class="px-4 py-3">{result.data.distance}</td>
              <td class="px-4 py-3 text-center">
                <span
                  class:list={[
                    'inline-flex items-center rounded-md px-2 py-1 text-xs font-medium',
                    getPodiumClass(result.data.rank),
                  ]}
                >
                  {result.data.rank}
                </span>
              </td>
              <td class="px-4 py-3 font-mono">{result.data.time}</td>
              <td class="px-4 py-3 text-center">
                {result.data.source && (
                  <a
                    class="text-primary-600 hover:underline text-sm rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
                    href={result.data.source[0]}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    Source
                  </a>
                )}
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</WidgetWrapper>
