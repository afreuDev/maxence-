---
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';

const { results } = Astro.props;
---

<WidgetWrapper>
  <Headline>
    <Fragment slot="title">Résultats récents</Fragment>
    <Fragment slot="subtitle">
      Palmarès de Maxence Mey sur le circuit professionnel.
    </Fragment>
  </Headline>

  <div class="space-y-8">
    {
      results.map((result: { data: any }) => {
        const { date, title, distance, rank, time, swim, bike, run, source } = result.data;
        const hasSplits = swim && bike && run && swim !== '—';

        return (
          <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-start p-4 rounded-lg bg-page-light hover:bg-page-lighter transition">

            {/* Date */}
            <div class="md:col-span-2 text-sm text-muted">
              {new Date(date).toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' })}
            </div>

            {/* Course Info */}
            <div class="md:col-span-4">
              <h3 class="font-bold text-lg text-primary">{title}</h3>
              <p class="text-sm text-muted">{distance}</p>
            </div>

            {/* Rank & Time */}
            <div class="md:col-span-3 text-left md:text-right">
              <p class="font-bold text-lg text-primary">{time}</p>
              <p class="text-sm text-muted">Classement: {rank}</p>
            </div>

            {/* Splits & Sources */}
            <div class="md:col-span-3 md:text-right">
              {hasSplits && (
                <div class="text-xs text-muted font-mono">
                  <span>{swim}</span> / <span>{bike}</span> / <span>{run}</span>
                </div>
              )}
              {Array.isArray(source) && source.length > 0 && (
                <div class="mt-2 flex flex-wrap gap-2 justify-start md:justify-end">
                  {source.map((link, index) => (
                    <a href={link} target="_blank" rel="noopener noreferrer" class="text-xs text-accent hover:underline">
                      {`Source ${index + 1}`}
                    </a>
                  ))}
                </div>
              )}
            </div>
          </div>
        )
      })
    }
  </div>
</WidgetWrapper>
