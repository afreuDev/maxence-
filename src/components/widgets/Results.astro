---
import { getCollection } from 'astro:content';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';

const results = (await getCollection('results')).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const podiumClass = (rank) => {
  if (rank === 1) return 'bg-yellow-100 text-yellow-800 ring-yellow-600/30';
  if (rank === 2) return 'bg-slate-100 text-slate-800 ring-slate-600/30';
  if (rank === 3) return 'bg-amber-100 text-amber-800 ring-amber-700/30';
  return '';
};
---

<WidgetWrapper>
  <Headline>
    <Fragment slot="title">Résultats</Fragment>
    <Fragment slot="subtitle">
      Retrouvez ici le palmarès de Maxence Mey sur les courses nationales et internationales.
    </Fragment>
  </Headline>
  <div class="relative not-prose overflow-x-auto">
    <table class="w-full text-left">
      <thead class="text-sm text-gray-500 dark:text-gray-400 uppercase">
        <tr>
          <th class="px-4 py-3 text-left w-[110px]">Date</th>
          <th class="px-4 py-3 text-left min-w-[180px]">Course</th>
          <th class="px-4 py-3 text-left w-[70px]">Dist.</th>
          <th class="px-4 py-3 text-left w-[90px]">Classt.</th>
          <th class="px-4 py-3 text-left w-[100px]">Temps</th>
        </tr>
      </thead>
      <tbody>
        {
          results.map((result) => (
            <tr class="border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition">
              <td class="px-4 py-3 font-medium">
                {new Date(result.data.date).toLocaleDateString('fr-FR', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric',
                })}
              </td>
              <td class="px-4 py-3 font-bold">{result.data.title}</td>
              <td class="px-4 py-3">{result.data.distance}</td>
              <td class="px-4 py-3">
                <span
                  class:list={[
                    'inline-flex items-center rounded-md px-2 py-1 text-xs font-medium',
                    podiumClass(result.data.rank),
                  ]}
                >
                  {result.data.rank}
                </span>
              </td>
              <td class="px-4 py-3 font-mono">{result.data.time}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</WidgetWrapper>
