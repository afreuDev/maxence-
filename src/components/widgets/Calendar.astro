---
const { race } = Astro.props;

// Calculate the countdown
const today = new Date();
today.setHours(0, 0, 0, 0);
const diff = race ? Math.ceil((new Date(race.date).getTime() - today.getTime()) / (1000 * 60 * 60 * 24)) : null;
const jLabel = diff !== null ? (diff > 0 ? `J-${diff}` : diff === 0 ? `Aujourd'hui` : null) : null;

// Format date for display
const formatDate = (date: Date) =>
  date.toLocaleDateString('fr-FR', {
    day: 'numeric',
    month: 'long',
    year: 'numeric',
  });
---

{
  race && (
    <section id="prochaine-course" class="py-16 sm:py-20 bg-page-lighter">
      <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-sm font-bold uppercase tracking-widest text-secondary">
          Prochaine Course
        </h2>

        <p class="mt-4 text-3xl md:text-4xl font-bold tracking-tight text-primary">
          {race.race}
        </p>

        <p class="mt-2 text-lg text-muted">
          {race.city} — {formatDate(new Date(race.date))}
        </p>

        {jLabel && (
          <div class="mt-4 inline-block bg-primary text-white text-xs font-semibold px-3 py-1 rounded-full">
            {jLabel}
          </div>
        )}

        {race.link && (
          <div class="mt-8">
            <a
              href={race.link}
              target="_blank"
              rel="noopener noreferrer"
              class="text-base font-medium text-accent hover:text-primary transition"
            >
              Détails officiels &rarr;
            </a>
          </div>
        )}
      </div>
    </section>
  )
}
