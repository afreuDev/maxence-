---
import Logo from '~/components/Logo.astro';
import ToggleMenu from '~/components/common/ToggleMenu.astro';
import { getHomePermalink } from '~/utils/permalinks';
import { trimSlash } from '~/utils/permalinks';

interface Link {
  text?: string;
  href?: string;
  ariaLabel?: string;
  icon?: string;
}

export interface Props {
  id?: string;
  links?: Array<Link>;
  isSticky?: boolean;
}

const {
  id = 'header',
  links = [],
  isSticky = false,
} = Astro.props;

const currentPath = `/${trimSlash(new URL(Astro.url).pathname)}`;
---

<header
  class:list={[
    'absolute top-0 z-40 w-full',
    {
      'is-sticky': isSticky,
    }
  ]}
  {...id ? { id } : {}}
>
  <div
    class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"
  >
    <div class="flex items-center justify-between h-16 md:h-20">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a href={getHomePermalink()}>
          <Logo />
        </a>
      </div>

      <!-- Desktop navigation -->
      <nav class="hidden md:flex md:space-x-8" aria-label="Main navigation">
        {
          links.map(({ text, href }) => (
            <a
              class:list={[
                'text-base font-medium text-white/80 hover:text-white transition-colors duration-200',
                { 'aw-link-active': href === currentPath },
              ]}
              href={href}
            >
              {text}
            </a>
          ))
        }
      </nav>

      <!-- Mobile menu button -->
      <div class="md:hidden flex items-center">
        <ToggleMenu>
          <span class="sr-only">Open main menu</span>
        </ToggleMenu>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div class="md:hidden" id="mobile-menu">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      {
        links.map(({ text, href }) => (
          <a
            class:list={[
              'block px-3 py-2 rounded-md text-base font-medium text-white/80 hover:text-white hover:bg-white/10',
              { 'aw-link-active': href === currentPath },
            ]}
            href={href}
          >
            {text}
          </a>
        ))
      }
    </div>
  </div>
</header>

<script>
  // Add scroll listener to handle header background
  document.addEventListener('DOMContentLoaded', () => {
    const header = document.getElementById('header');
    if (header && header.classList.contains('is-sticky')) {
      window.addEventListener('scroll', () => {
        if (window.scrollY > 20) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      });
    }

    // Mobile menu toggle
    const toggle = document.querySelector('[data-aw-toggle-menu]');
    const menu = document.getElementById('mobile-menu');
    if (toggle && menu) {
      menu.style.display = 'none'; // Initially hidden
      toggle.addEventListener('click', () => {
        toggle.classList.toggle('expanded');
        if (menu.style.display === 'none') {
          menu.style.display = 'block';
        } else {
          menu.style.display = 'none';
        }
      });

      // Close mobile menu when a link is clicked
      const menuLinks = menu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', () => {
          menu.style.display = 'none';
          toggle.classList.remove('expanded');
        });
      });
    }
  });
</script>

<style>
  #header {
    transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
  }
  #header.scrolled {
    background-color: var(--aw-color-bg-header);
    @apply backdrop-blur-lg border-b border-white/10;
  }

  /* Active link style */
  .aw-link-active {
    @apply text-white;
  }

  #mobile-menu {
    background-color: var(--aw-color-bg-mobile-menu);
    @apply hidden backdrop-blur-lg;
  }
  #mobile-menu.block {
    display: block;
  }
</style>
